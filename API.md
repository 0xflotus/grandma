# API Doc

## Alpha notice

**This project is still in its very early stages. I am still working on the MVP and the project is not yet ready for use. If you would like to see what is happening, I encourage you to look at the [MVP milestone](https://github.com/catdad/grandma/milestones/mvp).**

**I reserve the right to break any of the APIs presented here without notice, until the `0.1.0` release, at which point, I will begin following semver.**

This document is currently meant for me to record the current or desired API, and is subject to change before it is moved to the proper [README.md](README.md) file.

#### `grandma.run`

Options:
* `duration` {string|number} - the amount of time that the test should run for. This is the minimum amount of time that `grandma` will continue starting new tests. However, the actual full run might be longer, if tests take a while to finish. This is a number in milliseconds, or a string written as a number with `ms` (milliseconds), `s` (seconds), `m` (minutes), `h` (hours), `d` (days), or `w` (weeks), or a combination of those values. Example: `'1h30m26s'`
* `rate` {number} - the rate at which to start a new test, as a number per second. For example, `5` would indicate 5 tests runs per second. This value is not compatible with `concurrent`.
* `concurrent` {number} - the number of tests to run at once. When this value is used, a set amount of tests will start immediately, and when any test finished, it will be replaced with a new one. If `rate` is defined, this value will be ignored, and instead, the tests will run according to the rate value.
* `timeout` {string|number} - the amount of time to wait for each test before failing the test. The default is to wait indefinitely. This is set to a value similarly to `duration`. When a test times out, it will be reported as a failure with an `errorCode` of `-1`.
* `threads` {number} - the number of thread workers to run the tests in. This proeprty is optional and defaults to 1. There is usually no reason to set it higher than that.
* `output` {stream} - a stream to write report data to. This can be any writable stream, such as a file stream, or a stream-like object, like a [through](https://github.com/rvagg/through2) stream.
* `test` {object} - an object defining the test to run. It has the following properties:
  * `path` {string} - a string path to the JavaScript file defining the test.
  * `name` {string} - the name of the test. This value can be set to any string.

Example that runs 20 tests per second for 5 minutes:

```javascript
var fs = require('fs');
var path = require('path');
var grandma = require('grandma');

var output = path.resolve('path/to/report.log');

var options = {
    duration: '5m',
    rate: 20,
    output: output,
    test: {
        path: path.resolve('path/to/mytest.js'),
        name: 'mytest'
    }
};

grandma.run(options, callback);
```

Example that runs 10 concurrent tests for 1 day (24 hours):

```javascript
var fs = require('fs');
var path = require('path');
var grandma = require('grandma');

var output = path.resolve('path/to/report.log');

var options = {
    duration: '1d',
    concurrent: 10
    output: output,
    test: {
        path: path.resolve('path/to/mytest.js'),
        name: 'mytest'
    }
};

grandma.run(options, callback);
```

#### `grandma.report`

Options:
* `type` {string} - text, json, box, or plot. Default is json.
* `input` {stream} - readable stream of report data generated by `grandma.run`.
* `output` {stream} - writable stream to output the report to. This value is optional for the json reporter.
* `box` {object} - options of the box plot type.
  * `width` {number} - the maximum width, in characters, of the box plot. Default is 75.

Json example:

```javascript
var fs = require('fs');
var input = fs.createReadStream('/path/to/a/grandma.log');

var grandma = require('grandma');

grandma.report({
    input: input,
    type: 'json'
}, function(err, jsonObj) {
    if (err) {
        console.error('something went horribly wrong', err);
    } else {
        console.log(jsonObj);
    }
});

```

Text example printing to standard out:

```javascript
var fs = require('fs');
var input = fs.createReadStream('/path/to/a/grandma.log');
var output = process.stdout; // print to the console

var grandma = require('grandma');

grandma.report({
    input: input,
    output: output,
    type: 'text'
}, function(err) {
    if (err) {
        console.error('something went horribly wrong', err);
    } else {
        console.log('the report was written to the output stream');
    }
});
```

Plot example writing to a file:

```javascript
var fs = require('fs');
var input = fs.createReadStream('/path/to/a/grandma.log');
var output = fs.createWriteStream('/path/to/a/report.html');

var grandma = require('grandma');

grandma.report({
    input: input,
    output: output,
    type: 'plot'
}, function(err) {
    // ...
});
```
